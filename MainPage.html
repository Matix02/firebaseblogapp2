<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add a Title here</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-storage.js"></script>

    <style>
        progress[value] {
            /* Reset the default appearance */
            -webkit-appearance: none;
            appearance: none;

            width: 100%;
            height: 20px;
        }
    </style>
</head>
<body class="h-100">
<nav class="navbar navbar-expand-lg bg-dark text-white">
    <div class="container-fluid">
        <ul class="nav navbar-nav ">
            <li class="active">
                <a class="navbar-brand" style="color: whitesmoke; text-decoration-style: wavy;" href="#">
                    Blog App
                </a>
            </li>
            <li>
                <a class="nav-link" style="color: whitesmoke; text-decoration-style: wavy;" href="#">
                    <span style="color: white"> Home </span>
                </a>
            </li>
            <li>
                <a class="nav-link" style="color: whitesmoke; text-decoration-style: wavy;" href="#">
                    <span style="color: white"> My Blogs</span>
                </a>
            </li>
            <li>
                <a class="nav-link" style="color: whitesmoke; text-decoration-style: wavy;" href="#">
                    <span style="color: white"> Logout</span>
                </a>
            </li>
        </ul>
        <a id="btn-logout" href="#" >
            <button>
                wyloguj
            </button></a>
    </div>
</nav>

<div class="row h-100 bg-light">
    <div class="col-lg-0 bg-secondary">
        <ul class="nav flex-column">

        </ul>
    </div>

    <div class="col-lg-12">
        <div class="container" id="container">
            <!-- Blog Post Area -->
            <div class="jumbotron bg-dark" style="margin-top: 15px;">
                <script>
                    var counter = 0;
                </script>
                <div class="container text-center">
                    <form id="main-form">
                        <div class="form-group">
                            <textarea type="text" rows="5" placeholder="Description..." class="form-control" id="main-desc"></textarea>
                        </div>
                        <div class="form-group">
                            <input type="file" class="form-control" id="main-image"/>
                        </div>
                        <div class="form-group">
                            <img id="selected-image" width="250" height="150" src="#"/>
                        </div>
                        <div class="form-group">
                            <div class="progress bg-secondary">
                                <progress class="progress-bar bg-success" value="0" max="100" id="uploader">0%</progress>
                            </div>

                        </div>
                        <div class="form-group">
                            <button id="save-blog">Post</button>
                        </div>
                    </form>
                    <div id="result">

                    </div>
                </div>
            </div>
            <!-- Blog Post Area Ends Here -->

            <!-- After Blog Post Area -->
            <hr>
            <br><br><br>
            <div class="text-center bg-light text-dark">
                <h3>All new Blog Posts</h3>
            </div>
            <hr>
            <br>

            <div class="row container-fluid bg-3">
                <div class="col-sm-12" id="blogs">

                </div>
            </div>
            <br>
            <!-- After Blog Post Area Ends Here -->
            <!-- Validation and uploading of Blogs -->
            <script>
                var firebaseConfig = {
                    apiKey: "AIzaSyBs8aQxdIjqyS_5jY618bedRhC543pbrLQ",
                    authDomain: "bloggapp-c69c5.firebaseapp.com",
                    databaseURL: "https://bloggapp-c69c5-default-rtdb.europe-west1.firebasedatabase.app",
                    projectId: "bloggapp-c69c5",
                    storageBucket: "bloggapp-c69c5.appspot.com",
                    messagingSenderId: "43573396725",
                    appId: "1:43573396725:web:0357ddc073147d337171bc",
                    measurementId: "G-ESKG7JT46V"
                };

                firebase.initializeApp(firebaseConfig);

                var fileButton = document.getElementById('main-image');
                var uploader = document.getElementById('uploader');

                fileButton.addEventListener('change', function(e) {
                    var file = e.target.files[0];
                    var blogStorageRef = firebase.storage().ref('sweet_girls/' + file.name);
                    var task = blogStorageRef.put(file);

                    task.on('state_changed',
                        function progress(snapshot) {
                            uploader.value = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        },
                        function error(err) {

                        },
                        function complete() {
                            var gender = "xD2";
                            var randomnumber = Math.floor(Math.random() * 100);

                            var rootRef = firebase.database().ref().child("Blogs");
                            var userID = firebase.auth().currentUser.uid;
                            var usersRef = rootRef.child(userID);

                                var userData =
                                    {
                                        "gender": gender,
                                        "random": randomnumber
                                    };

                                usersRef.set(userData, function(error)
                                {
                                    if(error) {
                                        var errorMessage = error.message;
                                        window.alert("Message : " + errorMessage);
                                    }
                                });
                    }
                    );
                });
            </script>
        </div>
    </div>
</div>
<script>
    firebase.auth().onAuthStateChanged(function(user)
    {
        if(!user)
        {
            window.location.href = "singin.html";
        }
    });
</script>

</body>
</html>

